{% load static %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>오늘의 일본어 5문장</title>
  <link rel="stylesheet" href="{% static 'styles.css' %}">
{#  <script defer src="{% static 'main.js' %}"></script>#}
    <script type="module" src="{% static 'main.js' %}"></script>
</head>
<body>
  <header class="appbar">
  <div class="container appbar__inner">
    <h1 class="brand">Jacommi</h1>

    <nav class="appbar__right">
      {% if request.user.is_authenticated and ga and ga.photo_url %}
        <!-- ✅ 프로필 이미지가 있는 경우 -->
        <a class="avatar" href="/mypage" title="나의 문장 보기 ({{ ga.email }})">
          <img src="{{ ga.photo_url }}" alt="{{ ga.email }}" referrerpolicy="no-referrer">
        </a>
      {% elif request.user.is_authenticated %}
        <!-- ✅ 로그인은 되어있지만 프로필 이미지가 없는 경우 -->
        <a class="avatar avatar--fallback" href="/mypage" title="나의 문장 보기 ({{ request.user.email|default:request.user.username }})">
          <span>{{ request.user.username|first|upper }}</span>
        </a>
      {% else %}
        <!-- ✅ 로그인 안 된 경우 -->
        <a class="btn btn--primary" href="/api/auth/google/login">
          구글로 로그인/연동
        </a>
      {% endif %}
    </nav>
  </div>
</header>

  <main class="container fade-in">
    <section class="hero">
      <div>
  <h2 class="title">오늘의 일본어 5문장</h2>
  {% if payload and payload.meta and payload.meta.ko_desc %}
    <p class="subtitle">{{ payload.meta.ko_desc }}</p>
  {% else %}
    <p class="subtitle">다양한 비즈니스·일상 상황에서 바로 쓰는 회화 표현</p>
  {% endif %}
</div>

      <div class="actions">
        <!-- 알림 토글: 종 아이콘 버튼 -->
        <button id="notifToggle" class="icon-btn bell off" aria-pressed="false" title="알림 꺼짐">
          <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
            <path d="M12 22a2 2 0 0 0 2-2h-4a2 2 0 0 0 2 2Zm6-6v-5a6 6 0 1 0-12 0v5l-2 2v1h16v-1l-2-2Z" fill="currentColor" opacity="0.75"/>
          </svg>
          <span class="label">알림</span>
        </button>

        <!-- 수동 캘린더 저장 버튼 -->
        <button id="saveTodayBtn" class="btn btn--ghost">오늘 문장 캘린더에 저장하기</button>

{#        <a class="btn btn--ghost" href="/api/today" target="_blank">API 보기</a>#}
      </div>
    </section>

    {% if payload %}
  <section class="card">
    <div class="card__header">
      <h3 class="topic">{{ payload.topic }}</h3>
      <span class="badge">{{ payload.date }}</span>
    </div>

    <ol class="sentences">
      {% for s in payload.sentences %}
      <li class="sentence">
        <div class="sentence__ja">
          <button class="icon-btn" aria-label="재생" onclick="speakJa('{{ s.jp|escapejs }}')">▶︎</button>
          <span class="ja">{{ s.jp }}</span>
        </div>
        <div class="sentence__ko">{{ s.ko }}</div>

        <div class="sentence__tools">
          <button class="tool" onclick="navigator.clipboard.writeText('{{ s.jp|escapejs }}');">일본어 복사</button>
          <button class="tool" onclick="navigator.clipboard.writeText('{{ s.ko|escapejs }}');">한국어 복사</button>

          <!-- ✅ 추가: 나만의 문장 저장 버튼 -->
          <button
            class="tool save-sent-btn"
            data-idx="{{ forloop.counter0 }}"
            data-date="{{ payload.date }}"
            data-topic="{{ payload.topic }}"
            data-jp="{{ s.jp|escapejs }}"
            data-ko="{{ s.ko|escapejs }}"
          >
            ★ 저장
          </button>
        </div>
      </li>
      {% endfor %}
    </ol>
  </section>
{% else %}
  <section class="empty card">
    <h3>아직 생성된 문장이 없습니다</h3>
    <p>자정에 자동 생성되며, 관리자가 수동으로도 생성할 수 있습니다.</p>
    <a class="link subtle" href="/admin/">관리자 바로가기</a>
  </section>
{% endif %}
  </main>

  <footer class="container footer">
  <span class="muted">© Jacommi</span>

  <a class="link subtle" href="https://github.com/tejava7177" target="_blank" rel="noopener">
    <!-- GitHub 아이콘 (SVG) -->
    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="vertical-align:middle;margin-right:6px;">
      <path d="M12 .5C5.6.5.5 5.6.5 12c0 5.1 3.3 9.4 7.8 10.9.6.1.8-.3.8-.6v-2c-3.2.7-3.9-1.4-3.9-1.4-.5-1.2-1.2-1.6-1.2-1.6-.9-.6.1-.6.1-.6 1 .1 1.5 1 1.5 1 .9 1.5 2.4 1.1 3 .9.1-.7.4-1.1.7-1.3-2.6-.3-5.4-1.3-5.4-5.9 0-1.3.5-2.3 1.2-3.1-.1-.3-.5-1.5.1-3.2 0 0 1-.3 3.2 1.2a10.7 10.7 0 0 1 5.8 0c2.2-1.5 3.2-1.2 3.2-1.2.6 1.7.3 2.9.1 3.2.8.8 1.2 1.8 1.2 3.1 0 4.6-2.8 5.6-5.5 5.9.4.3.8 1 .8 2.1v3.1c0 .3.2.7.8.6A10.9 10.9 0 0 0 23.5 12C23.5 5.6 18.4.5 12 .5Z"/>
    </svg>
    GitHub
  </a>
</footer>

  <script>
    // TTS (브라우저 내장)
    function speakJa(text){
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ja-JP';
      speechSynthesis.speak(u);
    }
  </script>
</body>
</html>