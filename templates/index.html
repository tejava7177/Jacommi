<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>오늘의 일본어 5문장</title>
  <script>
    function speakJa(text){ const u=new SpeechSynthesisUtterance(text); u.lang='ja-JP'; speechSynthesis.speak(u); }
  </script>
</head>
<body>
  <h1>오늘의 일본어 5문장</h1>
  <a href="/api/auth/google/login">구글로 로그인/연동하기</a>
  <p><a href="/health">/health</a> | <a href="/api/today">/api/today</a></p>

  {% if payload %}
    <h3>{{ payload.topic }}</h3>
    <ol>
      {% for s in payload.sentences %}
        <li>
          <div>
            <b>{{ s.jp }}</b>
            <button onclick="speakJa('{{ s.jp|escapejs }}')">▶︎ 재생</button>
          </div>
          <div>{{ s.ko }}</div>
        </li>
      {% endfor %}
    </ol>
  {% else %}
    <p>아직 생성된 세트가 없어요. 대신 <a href="/api/today">/api/today</a>에서 더미 데이터를 확인할 수 있습니다.</p>
  {% endif %}
</body>
  <hr>
  <button id="enable-noti">알림 권한 허용 & 토큰 등록</button>
  <div id="noti-status" style="font-size:12px; opacity:0.8;"></div>

  <!-- Load FCM client code as an ES module -->
  <script type="module" src="/static/main.js"></script>
  <script>
    // Provide a user gesture to trigger permission + token registration
    document.getElementById('enable-noti')?.addEventListener('click', async () => {
      const el = document.getElementById('noti-status');
      try {
        if (window.registerFCM) {
          el.textContent = '요청 중...';
          await window.registerFCM();
          el.textContent = '완료! 브라우저 콘솔에서 토큰을 확인하세요.';
        } else {
          el.textContent = 'main.js 로딩 전입니다. 새로고침 후 다시 시도해주세요.';
        }
      } catch (e) {
        el.textContent = '실패: ' + e;
      }
    });
  </script>
</html>