{% load static %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>오늘의 일본어 5문장</title>
  <link rel="stylesheet" href="{% static 'styles.css' %}">
{#  <script defer src="{% static 'main.js' %}"></script>#}
    <script type="module" src="{% static 'main.js' %}"></script>
</head>
<body>
  <header class="appbar">
    <div class="container appbar__inner">
      <h1 class="brand">Jacommi</h1>

      <nav class="appbar__right">
  {% if request.user.is_authenticated and ga and ga.photo_url %}
    <a class="avatar" href="/admin/" title="{{ ga.email }}">
      <img src="{{ ga.photo_url }}" alt="{{ ga.email }}" referrerpolicy="no-referrer">
    </a>
  {% elif request.user.is_authenticated %}
    <a class="avatar avatar--fallback" href="/admin/" title="{{ request.user.email|default:request.user.username }}">
      <span>{{ request.user.username|first|upper }}</span>
    </a>
  {% else %}
    <a class="btn btn--primary" href="/api/auth/google/login">구글로 로그인/연동</a>
  {% endif %}
</nav>
    </div>
  </header>

  <main class="container fade-in">
    <section class="hero">
      <div>
        <h2 class="title">오늘의 일본어 5문장</h2>
        <p class="subtitle">업무 회의/협업에서 바로 쓰는 비즈니스 회화</p>
      </div>

      <div class="actions">
        <!-- 알림 토글: 종 아이콘 버튼 -->
        <button id="notifToggle" class="icon-btn bell off" aria-pressed="false" title="알림 꺼짐">
          <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
            <path d="M12 22a2 2 0 0 0 2-2h-4a2 2 0 0 0 2 2Zm6-6v-5a6 6 0 1 0-12 0v5l-2 2v1h16v-1l-2-2Z" fill="currentColor" opacity="0.75"/>
          </svg>
          <span class="label">알림</span>
        </button>

        <!-- 수동 캘린더 저장 버튼 -->
        <button id="saveTodayBtn" class="btn btn--ghost">오늘 문장 캘린더에 저장하기</button>

{#        <a class="btn btn--ghost" href="/api/today" target="_blank">API 보기</a>#}
      </div>
    </section>

    {% if payload %}
      <section class="card">
        <div class="card__header">
          <h3 class="topic">{{ payload.topic }}</h3>
          <span class="badge">{{ payload.date }}</span>
        </div>

        <ol class="sentences">
          {% for s in payload.sentences %}
          <li class="sentence">
            <div class="sentence__ja">
              <button class="icon-btn" aria-label="재생" onclick="speakJa('{{ s.jp|escapejs }}')">▶︎</button>
              <span class="ja">{{ s.jp }}</span>
            </div>
            <div class="sentence__ko">{{ s.ko }}</div>

            <div class="sentence__tools">
              <button class="tool" onclick="navigator.clipboard.writeText('{{ s.jp|escapejs }}');">일본어 복사</button>
              <button class="tool" onclick="navigator.clipboard.writeText('{{ s.ko|escapejs }}');">한국어 복사</button>
            </div>
          </li>
          {% endfor %}
        </ol>
      </section>
    {% else %}
      <section class="empty card">
        <h3>아직 생성된 문장이 없습니다</h3>
        <p>자정에 자동 생성되며, 관리자가 수동으로도 생성할 수 있습니다.</p>
        <a class="link subtle" href="/admin/">관리자 바로가기</a>
      </section>
    {% endif %}
  </main>

  <footer class="container footer">
    <span class="muted">© Jacommi</span>
    <a class="link subtle" href="/health">health</a>
  </footer>

  <script>
    // TTS (브라우저 내장)
    function speakJa(text){
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ja-JP';
      speechSynthesis.speak(u);
    }
  </script>
</body>
</html>