{% load static %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜¤ëŠ˜ì˜ ì¼ë³¸ì–´ 5ë¬¸ì¥</title>
  <link rel="stylesheet" href="{% static 'styles.css' %}">
  <script defer src="{% static 'main.js' %}"></script>
</head>
<body>
  <header class="appbar">
    <div class="container appbar__inner">
      <h1 class="brand">Jacommi</h1>

      <nav class="appbar__right">
  {% if request.user.is_authenticated and ga and ga.photo_url %}
    <a class="avatar" href="/admin/" title="{{ ga.email }}">
      <img src="{{ ga.photo_url }}" alt="{{ ga.email }}" referrerpolicy="no-referrer">
    </a>
  {% elif request.user.is_authenticated %}
    <span class="chip chip--success">ë¡œê·¸ì¸ë¨</span>
    <a class="link subtle" href="/admin/">ê´€ë¦¬</a>
  {% else %}
    <a class="btn btn--primary" href="/api/auth/google/login">êµ¬ê¸€ë¡œ ë¡œê·¸ì¸/ì—°ë™</a>
  {% endif %}
</nav>
    </div>
  </header>

  <main class="container fade-in">
    <section class="hero">
      <div>
        <h2 class="title">ì˜¤ëŠ˜ì˜ ì¼ë³¸ì–´ 5ë¬¸ì¥</h2>
        <p class="subtitle">ì—…ë¬´ íšŒì˜/í˜‘ì—…ì—ì„œ ë°”ë¡œ ì“°ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ íšŒí™”</p>
      </div>

      <div class="actions">
        <button id="btn-noti" class="btn">
          ğŸ”” ì•Œë¦¼ í—ˆìš© & í† í° ë“±ë¡
        </button>
        <a class="btn btn--ghost" href="/api/today" target="_blank">API ë³´ê¸°</a>
      </div>
    </section>

    {% if payload %}
      <section class="card">
        <div class="card__header">
          <h3 class="topic">{{ payload.topic }}</h3>
          <span class="badge">{{ payload.date }}</span>
        </div>

        <ol class="sentences">
          {% for s in payload.sentences %}
          <li class="sentence">
            <div class="sentence__ja">
              <button class="icon-btn" aria-label="ì¬ìƒ" onclick="speakJa('{{ s.jp|escapejs }}')">â–¶ï¸</button>
              <span class="ja">{{ s.jp }}</span>
            </div>
            <div class="sentence__ko">{{ s.ko }}</div>

            <div class="sentence__tools">
              <button class="tool" onclick="navigator.clipboard.writeText('{{ s.jp|escapejs }}');">ì¼ë³¸ì–´ ë³µì‚¬</button>
              <button class="tool" onclick="navigator.clipboard.writeText('{{ s.ko|escapejs }}');">í•œêµ­ì–´ ë³µì‚¬</button>
            </div>
          </li>
          {% endfor %}
        </ol>
      </section>
    {% else %}
      <section class="empty card">
        <h3>ì•„ì§ ìƒì„±ëœ ë¬¸ì¥ì´ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>ìì •ì— ìë™ ìƒì„±ë˜ë©°, ê´€ë¦¬ìê°€ ìˆ˜ë™ìœ¼ë¡œë„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <a class="link subtle" href="/admin/">ê´€ë¦¬ì ë°”ë¡œê°€ê¸°</a>
      </section>
    {% endif %}
  </main>

  <footer class="container footer">
    <span class="muted">Â© Jacommi</span>
    <a class="link subtle" href="/health">health</a>
  </footer>

  <script>
    // TTS (ë¸Œë¼ìš°ì € ë‚´ì¥)
    function speakJa(text){
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ja-JP';
      speechSynthesis.speak(u);
    }

    // ì•Œë¦¼ ë²„íŠ¼ -> main.js ì— ìˆëŠ” register ë¡œ ìœ„ì„ (ìˆìœ¼ë©´ ì‚¬ìš©)
    document.getElementById('btn-noti')?.addEventListener('click', () => {
      if (window.requestFcmPermissionAndRegister) {
        window.requestFcmPermissionAndRegister();
      } else {
        alert('ì•Œë¦¼ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      }
    });
  </script>
</body>
</html>